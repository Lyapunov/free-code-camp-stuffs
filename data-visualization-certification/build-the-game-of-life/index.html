<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/blitzer/jquery-ui.css" rel="stylesheet" type="text/css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-with-addons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>

<!-- 
  CSS 
-->
<link rel="stylesheet" type="text/css" href="basic.css">

<!-- 
  JS 
-->
<script type="text/babel">
var mountNode = document.getElementById('game-of-life-container');

class GameOfLife extends React.Component {
   constructor(props) {
      super(props);
      this.state = {};
      this.state.board = [];
      this.state.boardy = 40;
      this.state.boardx = 40;
      this.state.generation = 0;
      this.state.running = false;
      this.state.runcount = 0;
      this.state.runspeed = 1;
      this.set_random_board_and_refresh = this.set_random_board_and_refresh.bind(this);
      this.set_clear_board_and_refresh  = this.set_clear_board_and_refresh.bind(this);
      console.log('--->',this.state.board);
      this.set_board_with_function(this.state.board,this.state,x=>Math.floor(Math.random()*8<=2));
      console.log('===>',this.state.board);
      this.next_generation = this.next_generation.bind(this);
      this.next_generation();
      this.running_on  = this.running_on.bind(this);
      this.running_off = this.running_off.bind(this);
   }

   next_generation() {
      if ( this.state.running ) {
         this.state.runcount++;
         if ( this.state.runcount >= this.state.runspeed ) {
            this.state.runcount = 0;
            this.state.generation++;
            this.setState( this.state ); 
         }
      }

      var self = this;
      setTimeout( function() {
         self.next_generation();
      }, 50 );
   }

   running_on() {
      this.state.running = true;
   }

   running_off() {
      this.state.running = false;
   }

   set_board_with_function(target, state, funct) {
      for ( var row = 0; row < state.boardy; ++row ) {
         var rowc = [];
         for ( var column = 0; column < state.boardx; ++column ) {
            rowc.push(funct());
         }
         target.push(rowc);
      }
   }

   set_random_board_and_refresh() {
      this.state.running = false;
      this.state.generation = 0;
      this.state.board = [];
      this.set_board_with_function(this.state.board,this.state,x=>Math.floor(Math.random()*8<=2));
      console.log(this.state.board);
      this.setState( this.state );
   }
   
   set_clear_board_and_refresh() {
      this.state.running = false;
      this.state.generation = 0;
      this.state.board = [];
      this.set_board_with_function(this.state.board,this.state,x=>0);
      this.setState( this.state );
   }
 
   render() {
      var content = [];
      for (var row = 0; row < this.state.boardy; ++row) {
         var rowKey="game-of-life-table-row-"+row;
         var content2 = [];
         for ( var column = 0; column < this.state.boardx; ++column ) {
            var columnKey="game-of-life-table-cell-"+row+"-"+column;
            var color = this.state.board[row][column];
            var cdescs = ["-none","-half","-full"];
            content2.push(<td key={columnKey} className={"game-of-life-cell"+cdescs[color]}></td>);
         }
         content.push(<tr key={rowKey}>{content2}</tr>);
      }

      return (
         <div>
         <div className="game-of-life-bar">
            <div className="game-of-life-upperbuttons">
               <button className="btn-success game-of-life-upper-button" onClick={this.running_on}>Run</button>
               <button className="btn-success game-of-life-upper-button" onClick={this.running_off}>Pause</button>
               <button className="btn-success game-of-life-upper-button" onClick={this.set_clear_board_and_refresh}>Clear</button>
               <button className="btn-success game-of-life-upper-button" onClick={this.set_random_board_and_refresh}>Random</button>
               <div className="game-of-life-upper-text">{"Generation: "+(this.state.generation)}</div>
            </div>
         </div>
         <div className="game-of-life-outer">
            <table className="game-of-life-table">
               {content} 
            </table>
         </div>
         </div>
      );
   }
}

ReactDOM.render(<GameOfLife/>, mountNode);

</script>

<!-- 
  HTML  
-->
<body>
   <div id="game-of-life-container"></div>
</body>
