<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- 
  CSS 
-->
<link rel="stylesheet" type="text/css" href="basic.css">


<style>

/* https://stackoverflow.com/questions/3331353/transitions-on-the-display-property */

.recipebox-body-off {
   transition: max-height 1.0s ease;
   max-height: 0;
   overflow: hidden;
}

.recipebox-body-on {
   transition: max-height 1.0s ease;
   max-height: 300;
   overflow: hidden;
}

</style>

<!-- 
  JS 
-->
<script type="text/babel">
// See https://stackoverflow.com/questions/39462458/react-js-creating-simple-table, I used it as a basis

function withPostfix(num) {
   if ( num == 1 ) {
      return "1st";
   }
   if ( num == 2 ) {
      return "2nd";
   }
   if ( num == 3 ) {
      return "3rd";
   }
   return ""+num+"th";
}

class RecipeBox extends React.Component {
   constructor(props){
      super(props);
      this.state = {}

      // See for some recerence: https://stackoverflow.com/questions/2010892/storing-objects-in-html5-localstorage
      var recipeBox = JSON.parse(localStorage.getItem('recipeBox'));
      if ( !recipeBox ) {
         recipeBox = [{title:'chocolate bar',ingredients:'chocolate, bar'},{title:'apple pie',ingredients:'apple, pie, chocolate, bar'}];
      }
      localStorage.setItem('recipeBox', JSON.stringify(recipeBox));
      this.state.recipeBox = recipeBox;
      this.state.enabled = [];
      this.toggle = this.toggle.bind(this);
   }

   toggle(i) {
      console.log(i);
      console.log(i.currentTarget.id);
      var id_field = i.currentTarget.id;
      var fields = id_field.split('-');
      this.state.enabled[ parseInt(fields[fields.length-1])-1 ] = 1 - (this.state.enabled[ parseInt(fields[fields.length-1])-1 ] ? 1: 0);
      console.log(this.state.enabled);
      this.setState( this.state );
   }

   render() {
      var rows = [];
      var mockid = 0;
      console.log('===>', this.state.recipeBox);

      for (var i = 0; i < this.state.recipeBox.length; i++) {
         var content = [];
         var ingredients = this.state.recipeBox[i].ingredients.split(',');
         for (var j = 0; j < ingredients.length; ++j) {
            content.push(<p className='recipebox-ingredient'>{ingredients[j]}</p>);
         }
         ++mockid;
         var mainkey = "recipebox-recipe-"+mockid;
         var headkey = "recipebox-recipe-headline-"+mockid;
         var bodykey = "recipebox-recipe-body-"+mockid;
         var contenti = this.state.enabled[i] ? "recipebox-body-on" : "recipebox-body-off";
         rows.push(<div key={mainkey} className='recipebox-recipe'>
                      <p key={headkey} className='recipebox-headline' id={headkey} onClick={this.toggle}>{this.state.recipeBox[i].title}</p>
                      <div key={bodykey} id={bodykey} className={contenti}>{content}</div>
                   </div>);
      }

      return(
         <div className='recipebox-main'>
            {rows}
         </div>
      );
   }
}

var mountNode = document.getElementById('recipebox-container');
ReactDOM.render(<RecipeBox/>, mountNode);
</script>

<!-- 
  HTML  
-->
<body>
   <div id="recipebox-header" class="recipebox-horizontal-bar">
      <p class="noselect fixed-big-font">Recipe Box</p>
   </div>
   <div id="recipebox-container"></div>
</body>
