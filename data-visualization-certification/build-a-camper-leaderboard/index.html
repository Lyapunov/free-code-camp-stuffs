<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/remarkable/1.7.1/remarkable.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- 
  CSS 
-->
<link rel="stylesheet" type="text/css" href="basic.css">

<!-- 
  JS 
-->
<script type="text/babel">
var mountNode = document.getElementById('leaderboard-container');

// See https://stackoverflow.com/questions/39462458/react-js-creating-simple-table, I used it as a basis

function withPostfix(num) {
   if ( num == 1 ) {
      return "1st";
   }
   if ( num == 2 ) {
      return "2nd";
   }
   if ( num == 3 ) {
      return "3rd";
   }
   return ""+num+"th";
}

class CamperLeaderboard extends React.Component {
   constructor(props){
      super(props);
      this.state = {}
      this.state.size = 5;
      this.state.renderstate = 0;
      var self = this;

      $.ajax({
         type: "GET",
         url: "https://fcctop100.herokuapp.com/api/fccusers/top/recent",
         success: function(data) {
            console.log("success:",data);
            self.state.recenttop = data;
            self.state.size = 7;
            self.state.renderstate += 1;
            self.setState( self.state );
         },
         error: function(XMLHttpRequest, textStatus, errorThrown) {
         }
      });

      $.ajax({
         type: "GET",
         url: "https://fcctop100.herokuapp.com/api/fccusers/top/alltime",
         success: function(data) {
            console.log("success:",data);
            self.state.alltimetop = data;
            self.state.size = 9;
            self.state.renderstate += 2;
            self.setState( self.state );
         },
         error: function(XMLHttpRequest, textStatus, errorThrown) {
         }
      });
   }
   render(){
      var rows = [];
      if ( this.state.renderstate == 3 ) {
         var mockid = 0;
         var selected = this.state.alltimetop;
         {
            var cell = []
            cell.push(<td key={mockid++} className='leaderboard-cell-half leaderboard-headline'>Rank</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell leaderboard-headline'>Username</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell-half leaderboard-headline'>Image</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell leaderboard-headline'>Recent points</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell leaderboard-headline'>Alltime points</td>);
            rows.push(<tr key={mockid++} className='leaderboard-row leaderboard-headline'>{cell}</tr>)
         }

         for (var i = 0; i < selected.length; i++){
            var cell = []
            cell.push(<td key={mockid++} className='leaderboard-cell-half'>{withPostfix(i+1)}</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell'>{selected[i].username}</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell-half'><img src={selected[i].img} className='leaderboard-img'/></td>);
            cell.push(<td key={mockid++} className='leaderboard-cell'>{selected[i].recent}</td>);
            cell.push(<td key={mockid++} className='leaderboard-cell'>{selected[i].alltime}</td>);
            rows.push(<tr key={mockid++} className='leaderboard-row'>{cell}</tr>)
         }
      }
      return(
         <div className="container">
            <table className='leaderboard-table' id="simple-board">
               <tbody>
                  {rows}
               </tbody>
            </table>
         </div>
      )
   }
}

ReactDOM.render(<CamperLeaderboard/>, mountNode);
</script>

<!-- 
  HTML  
-->
<body>
   <div id="leaderboard-header" class="leaderboard-horizontal-bar">
      <p class="noselect big-font">Camper-leaderboard</p>
   </div>
   <div id="leaderboard-container"></div>
</body>
