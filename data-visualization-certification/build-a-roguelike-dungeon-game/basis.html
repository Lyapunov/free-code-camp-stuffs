<!DOCTYPE HTML>
<html>
   <head>
      <style>
         body {
            margin : 0px;
            padding: 0px;
            cursor : none;
         }
      </style>
   </head>
   <body>
   	<canvas id="canvas" width="500" height="500">
      Your browser doesn't support html5 canvas.
      </canvas>
      <script>
         var mainItem     = document.getElementById('canvas');
         var context      = mainItem.getContext('2d');

         var screenWidth  = mainItem.width  = window.innerWidth  - 20;
         var screenHeight = mainItem.height = window.innerHeight - 20;
         var screenScale  = Math.min( screenWidth, screenHeight ) / 2;
         var tileSize = 50;
         var mapRadiusX = screenWidth/2/tileSize/Math.sqrt(3);
         var mapRadiusY = screenHeight/2/tileSize;
         var mapRadius = Math.ceil(2 * Math.max(mapRadiusX,mapRadiusY));

         var fps = 25;
         var ANIMATION;

         var curX = 0;
         var curY = 0;
         var curTarg = 0;
         var figureWay = [];

         //================================= AVATAR ANIMATION BEGINS =================================

         var characterBodyData = 
[
[[20.5,29.3,5],[19.3,34.9,5],[18.3,40.5,5],[17.7,46.9,5],[18.1,52.7,5],[18.5,57.1,5],[18.9,62.099999999999994,5],[19.1,68.1,5],[19.5,74.5,5],[19.5,81.9,5],[17.1,12.3,15],[19,29.4,12],[18.4,47,12],[27.1,32.7,5],[28.5,39.5,5],[28.9,47.5,5],[28.1,55.5,5],[26.7,62.7,5],[22.5,60.7,5],[23.3,67.9,5],[23.3,75.1,5],[24.5,82.3,5],[24.5,88.9,5]],
[[21.9,30.299999999999997,5],[21.1,36.7,5],[21.1,44.3,5],[18.9,51.3,5],[13.899999999999999,55.7,5],[19.7,58.5,5],[19.1,64.3,5],[16.7,69.1,5],[25.5,74.3,5],[33.1,76.9,5],[17.1,11.899999999999999,15],[20,29.799999999999997,12],[19.6,46.4,12],[28.9,32.9,5],[29.700000000000003,40.5,5],[30.5,47.5,5],[30.5,55.1,5],[28.3,62.099999999999994,5],[23.9,59.5,5],[23.3,66.7,5],[23.1,73.3,5],[24.3,81.3,5],[25.9,88.5,5]],
[[24.5,31.299999999999997,5],[27.3,36.3,5],[28.3,43.7,5],[29.1,48.9,5],[28.7,55.3,5],[19.7,56.9,5],[15.100000000000001,62.7,5],[10.1,69.1,5],[13.5,73.5,5],[14.899999999999999,78.1,5],[17.5,10.7,15],[20.4,29.799999999999997,12],[21,43.4,12],[23.1,31.1,5],[22.9,38.5,5],[21.5,45.7,5],[19.5,52.5,5],[15.100000000000001,57.7,5],[24.9,56.9,5],[25.5,65.7,5],[26.1,73.5,5],[29.9,81.7,5],[33.3,88.1,5]],
[[29.5,28.9,5],[31.1,35.5,5],[32.9,42.1,5],[32.3,48.1,5],[31.9,54.1,5],[19.5,57.5,5],[15.7,62.3,5],[11.3,68.1,5],[7.9,75.1,5],[3.0999999999999996,80.5,5],[17.7,11.5,15],[20.6,29.4,12],[19.4,45.2,12],[22.3,31.5,5],[16.3,51.3,5],[19.3,44.9,5],[21.7,37.7,5],[12.5,55.5,5],[25.7,57.5,5],[27.5,65.7,5],[30.1,74.7,5],[38.1,79.7,5],[45.5,84.1,5]],
[[29.1,32.5,5],[31.700000000000003,37.9,5],[32.9,44.3,5],[34.1,49.5,5],[33.5,55.5,5],[19.9,58.9,5],[14.5,63.5,5],[10.3,68.3,5],[11.5,75.1,5],[12.1,81.7,5],[16.9,15.100000000000001,15],[20.8,33,12],[20.4,46.8,12],[21.1,33.7,5],[21.1,41.5,5],[21.1,48.9,5],[17.5,53.1,5],[12.9,54.3,5],[25.9,58.9,5],[26.5,65.7,5],[27.3,72.1,5],[32.7,77.5,5],[39.1,81.1,5]],
[[25.7,33.3,5],[28.1,40.5,5],[28.7,46.5,5],[28.1,53.7,5],[28.1,60.3,5],[20.5,63.3,5],[19.3,58.7,5],[18.9,70.1,5],[21.9,76.3,5],[22.7,82.1,5],[16.9,12.3,15],[19.8,31.200000000000003,12],[20.6,45.4,12],[24.3,33.5,5],[23.3,40.3,5],[21.9,46.5,5],[20.1,52.5,5],[15.7,58.1,5],[24.1,57.5,5],[21.9,63.3,5],[20.3,69.9,5],[27.1,73.1,5],[33.1,75.9,5]],
[[20.7,29.9,5],[20.5,37.5,5],[20.1,45.3,5],[16.7,50.1,5],[13.1,54.9,5],[23.5,56.7,5],[25.3,63.3,5],[26.5,69.9,5],[28.9,75.9,5],[29.3,80.7,5],[17.3,9.899999999999999,15],[20,29.6,12],[21.4,44.4,12],[26.1,30.1,5],[27.9,38.7,5],[29.5,46.7,5],[29.5,54.3,5],[28.5,60.9,5],[22.3,55.3,5],[18.3,60.9,5],[16.5,66.5,5],[18.7,72.3,5],[20.7,77.3,5]],
[[21.9,30.700000000000003,5],[16.3,46.9,5],[20.9,41.5,5],[21.7,33.9,5],[13.3,51.1,5],[26.7,59.3,5],[28.3,66.1,5],[31.1,71.9,5],[37.5,75.5,5],[43.7,78.1,5],[16.9,11.5,15],[19.6,30,12],[20,46.8,12],[29.3,30.1,5],[31.9,36.7,5],[34.7,42.5,5],[34.7,49.7,5],[34.5,56.5,5],[21.3,59.3,5],[17.7,67.3,5],[12.3,74.7,5],[7.5,82.5,5],[2.5,89.1,5]],
[[20.5,33.5,5],[19.5,35.7,5],[19.7,42.7,5],[16.3,48.1,5],[12.9,51.9,5],[24.7,59.3,5],[24.5,66.3,5],[26.5,73.7,5],[32.7,76.7,5],[39.5,77.1,5],[17.9,15.5,15],[19,32.8,12],[20,46.6,12],[26.1,34.3,5],[31.700000000000003,37.9,5],[34.1,46.3,5],[35.5,53.1,5],[35.5,59.3,5],[19.9,59.7,5],[15.899999999999999,66.7,5],[10.7,74.3,5],[11.5,81.1,5],[12.7,87.9,5]],
[[17.5,29.3,5],[15.100000000000001,35.3,5],[13.7,42.1,5],[12.7,49.1,5],[12.5,56.9,5],[17.9,55.5,5],[17.3,62.099999999999994,5],[17.5,69.5,5],[18.3,77.1,5],[19.1,84.5,5],[17.9,13.100000000000001,15],[19.4,29.4,12],[18.6,43.6,12],[31.299999999999997,32.7,5],[32.7,40.5,5],[32.7,48.7,5],[32.1,56.3,5],[30.299999999999997,63.099999999999994,5],[25.3,56.1,5],[25.5,63.7,5],[26.1,72.3,5],[27.3,80.5,5],[29.1,88.7,5]],
[[18.3,29.1,5],[17.3,35.7,5],[16.7,41.9,5],[15.899999999999999,48.9,5],[14.3,55.3,5],[19.5,55.1,5],[19.1,62.5,5],[18.9,70.3,5],[25.7,69.1,5],[31.700000000000003,67.1,5],[18.1,12.100000000000001,15],[20.6,28.799999999999997,12],[19.8,44.6,12],[31.5,28.7,5],[33.5,35.5,5],[35.1,43.9,5],[34.5,51.1,5],[32.7,58.7,5],[26.9,55.3,5],[26.3,62.099999999999994,5],[26.9,69.3,5],[28.3,77.1,5],[30.1,84.7,5]],
[[20.1,27.7,5],[19.7,33.3,5],[20.1,39.1,5],[19.7,44.7,5],[19.3,50.3,5],[28.1,53.1,5],[28.1,59.9,5],[28.5,68.1,5],[31.9,74.7,5],[34.5,81.7,5],[18.5,10.5,15],[20.4,27.799999999999997,12],[21.6,40.6,12],[29.3,30.299999999999997,5],[29.3,36.5,5],[28.7,43.5,5],[26.9,51.9,5],[23.3,58.9,5],[20.3,52.7,5],[16.3,59.9,5],[12.3,66.7,5],[15.7,71.9,5],[20.7,76.3,5]],
[[22.3,28.3,5],[25.9,33.5,5],[26.5,39.3,5],[29.700000000000003,42.9,5],[31.700000000000003,47.7,5],[21.3,54.7,5],[16.9,62.5,5],[14.5,69.5,5],[11.5,77.1,5],[8.1,84.5,5],[18.3,11.3,15],[19.8,28.4,12],[20,43.6,12],[30.5,30.700000000000003,5],[29.700000000000003,37.1,5],[26.5,44.1,5],[23.7,51.1,5],[19.7,56.5,5],[27.5,54.1,5],[28.9,59.5,5],[30.700000000000003,65.1,5],[34.7,70.3,5],[40.1,74.3,5]],
[[20.7,31.1,5],[20.5,35.5,5],[22.7,39.5,5],[27.5,42.1,5],[31.700000000000003,45.7,5],[20.1,56.1,5],[15.7,62.3,5],[11.5,69.1,5],[11.5,76.5,5],[10.7,84.1,5],[18.3,15.5,15],[20,31.200000000000003,12],[20,44.2,12],[30.1,33.5,5],[28.9,40.3,5],[25.5,47.1,5],[22.1,52.5,5],[18.5,57.7,5],[26.5,55.9,5],[28.5,62.3,5],[30.299999999999997,68.3,5],[35.1,71.3,5],[40.3,73.9,5]],
[[20.1,29.5,5],[20.3,35.5,5],[20.5,40.1,5],[21.5,45.7,5],[21.3,50.7,5],[26.5,50.9,5],[25.9,57.7,5],[25.5,64.9,5],[29.5,67.7,5],[34.5,69.5,5],[17.9,12.3,15],[21,29.4,12],[21.6,41.6,12],[30.1,29.9,5],[31.9,37.5,5],[31.5,45.5,5],[30.299999999999997,52.7,5],[29.1,59.5,5],[20.3,51.1,5],[20.3,58.3,5],[20.1,65.5,5],[21.1,72.7,5],[25.1,79.1,5]],
[[18.7,28.5,5],[17.7,34.5,5],[16.3,41.3,5],[14.899999999999999,46.9,5],[11.7,52.1,5],[20.5,51.1,5],[19.9,56.9,5],[21.5,64.5,5],[25.3,69.3,5],[27.5,76.3,5],[18.3,9.7,15],[20.8,27.6,12],[20.4,39.6,12],[31.1,28.7,5],[33.3,34.5,5],[35.3,40.9,5],[36.3,47.3,5],[36.3,53.3,5],[26.5,50.9,5],[23.3,56.1,5],[20.3,61.5,5],[20.5,69.1,5],[20.9,76.1,5]],
[[17.5,29.3,5],[17.1,34.7,5],[14.899999999999999,40.3,5],[12.7,46.5,5],[11.1,52.3,5],[20.1,54.3,5],[21.3,59.5,5],[23.1,64.9,5],[28.3,70.5,5],[33.7,72.5,5],[18.3,11.100000000000001,15],[20.2,29.200000000000003,12],[20.4,42,12],[32.3,30.1,5],[34.5,35.7,5],[37.1,42.5,5],[39.1,47.9,5],[40.3,54.3,5],[25.3,62.7,5],[22.5,71.7,5],[27.3,55.1,5],[19.9,80.9,5],[17.7,90.1,5]],
[[17.9,32.3,5],[16.5,38.3,5],[13.7,43.9,5],[11.7,49.7,5],[9.1,54.5,5],[20.1,56.5,5],[19.5,64.1,5],[20.7,71.1,5],[26.3,71.7,5],[31.299999999999997,71.9,5],[17.9,15.3,15],[20.2,31.6,12],[20.8,44.4,12],[31.700000000000003,31.9,5],[33.9,37.1,5],[36.5,42.5,5],[38.5,49.5,5],[38.9,56.7,5],[25.7,64.3,5],[27.3,56.7,5],[21.1,70.9,5],[23.9,87.7,5],[22.7,79.5,5]],
[[16.1,31.1,5],[14.5,38.3,5],[13.5,45.5,5],[14.3,52.7,5],[15.5,58.7,5],[20.9,58.3,5],[20.3,65.5,5],[20.5,72.9,5],[20.5,80.1,5],[21.5,88.3,5],[19.7,13.3,15],[21.4,30.200000000000003,12],[21.6,46.4,12],[33.5,31.1,5],[35.7,37.5,5],[36.3,45.1,5],[35.5,52.3,5],[34.9,58.9,5],[29.5,58.7,5],[29.9,65.7,5],[29.5,72.9,5],[28.7,80.7,5],[28.9,87.9,5]],
[[16.7,29.3,5],[15.899999999999999,36.3,5],[15.100000000000001,43.3,5],[14.899999999999999,50.5,5],[15.899999999999999,57.9,5],[21.1,55.5,5],[20.3,63.3,5],[20.9,71.3,5],[23.7,68.5,5],[23.5,64.7,5],[19.9,12.5,15],[21.8,28,12],[21.6,43.4,12],[33.7,28.9,5],[34.3,35.7,5],[34.5,42.7,5],[34.7,50.5,5],[33.7,57.9,5],[28.7,55.5,5],[29.700000000000003,62.099999999999994,5],[29.9,68.7,5],[28.1,75.7,5],[27.5,82.7,5]],
[[17.3,28.3,5],[16.5,34.3,5],[16.9,39.7,5],[17.3,45.5,5],[19.7,50.3,5],[28.5,53.9,5],[28.5,72.1,5],[28.9,65.9,5],[29.700000000000003,59.7,5],[28.5,78.1,5],[19.9,10.5,15],[21.6,27.799999999999997,12],[22,41.8,12],[32.9,28.1,5],[34.1,34.7,5],[34.5,40.9,5],[33.9,48.3,5],[31.299999999999997,54.3,5],[20.1,59.1,5],[21.5,53.7,5],[18.9,64.7,5],[19.7,70.1,5],[21.5,75.5,5]],
[[17.1,28.7,5],[17.3,34.5,5],[18.9,40.7,5],[19.9,46.3,5],[20.3,51.9,5],[29.5,53.5,5],[31.1,55.9,5],[30.700000000000003,58.9,5],[28.5,62.099999999999994,5],[26.5,65.5,5],[20.1,11.5,15],[22,28.6,12],[22,42,12],[33.5,28.9,5],[33.7,35.7,5],[33.9,42.9,5],[31.1,50.7,5],[26.3,57.7,5],[21.1,62.099999999999994,5],[21.1,54.1,5],[21.9,78.7,5],[21.7,70.9,5],[21.3,86.3,5]],
[[17.5,31.5,5],[16.9,36.7,5],[17.1,42.3,5],[17.9,47.7,5],[18.7,53.3,5],[28.5,56.7,5],[29.1,65.5,5],[30.700000000000003,61.3,5],[28.1,68.9,5],[26.1,71.7,5],[19.9,15.5,15],[22,31.6,12],[22,44.6,12],[32.1,31.700000000000003,5],[34.9,38.3,5],[34.7,45.9,5],[34.1,53.1,5],[30.5,59.9,5],[20.9,57.1,5],[20.7,70.3,5],[21.3,76.7,5],[20.5,63.5,5],[21.9,82.9,5]],
[[16.9,29.5,5],[15.5,36.5,5],[14.3,44.3,5],[15.3,50.9,5],[15.899999999999999,57.1,5],[21.1,54.3,5],[20.3,60.7,5],[20.9,68.7,5],[21.5,75.7,5],[21.9,82.5,5],[20.3,13.3,15],[21.4,29,12],[21.4,42,12],[33.3,29.5,5],[34.5,36.5,5],[34.7,43.9,5],[34.5,50.3,5],[33.9,57.3,5],[28.7,54.1,5],[27.5,67.5,5],[29.1,70.5,5],[29.700000000000003,61.5,5],[27.3,66.1,5]],
[[32.7,28.7,5],[33.3,33.1,5],[32.7,38.1,5],[32.5,44.3,5],[30.9,49.3,5],[21.5,53.3,5],[20.7,65.3,5],[21.1,59.5,5],[21.1,71.7,5],[21.9,77.9,5],[19.9,10.7,15],[21.6,27.799999999999997,12],[21.8,41.4,12],[17.9,27.5,5],[16.1,33.7,5],[15.7,40.9,5],[16.3,47.5,5],[18.7,54.1,5],[28.5,53.1,5],[30.299999999999997,58.7,5],[31.5,64.9,5],[30.5,70.3,5],[27.7,75.5,5]],
[[31.9,27.9,5],[30.9,43.3,5],[32.1,37.9,5],[32.3,32.5,5],[31.1,48.3,5],[21.7,53.7,5],[19.7,56.1,5],[19.5,59.3,5],[21.7,61.7,5],[23.1,64.1,5],[20.3,11.100000000000001,15],[21.6,27.799999999999997,12],[21.8,41.8,12],[18.1,28.5,5],[16.3,34.9,5],[17.1,42.7,5],[18.9,49.5,5],[23.7,57.3,5],[28.9,53.5,5],[29.9,61.3,5],[29.3,69.5,5],[29.5,77.7,5],[28.9,86.3,5]],
[[33.5,31.9,5],[32.9,37.7,5],[33.1,43.3,5],[32.7,49.7,5],[30.5,53.5,5],[21.5,57.5,5],[21.3,60.5,5],[20.7,64.1,5],[21.9,68.1,5],[22.5,71.3,5],[19.7,15.5,15],[21.6,31.799999999999997,12],[21.2,45,12],[17.7,31.700000000000003,5],[15.3,38.3,5],[15.3,46.1,5],[16.1,52.5,5],[19.1,58.9,5],[28.3,57.1,5],[29.1,63.900000000000006,5],[29.700000000000003,71.1,5],[29.3,77.1,5],[28.7,83.3,5]],
[[34.1,27.9,5],[36.5,34.9,5],[37.3,42.9,5],[38.7,49.3,5],[38.5,56.3,5],[25.7,55.5,5],[24.7,64.1,5],[24.5,72.7,5],[23.9,80.7,5],[22.1,88.7,5],[22.7,12.5,15],[24.4,29.4,12],[25.4,43.6,12],[19.9,32.3,5],[18.1,40.3,5],[17.5,47.9,5],[19.3,54.5,5],[20.5,61.3,5],[33.7,54.7,5],[33.9,61.1,5],[33.7,68.3,5],[33.3,76.1,5],[31.5,83.7,5]],
[[29.1,29.9,5],[29.3,36.3,5],[29.9,42.3,5],[30.5,47.7,5],[30.9,52.7,5],[30.9,52.3,5],[30.9,59.3,5],[30.700000000000003,66.3,5],[29.700000000000003,73.7,5],[26.3,80.3,5],[22.9,12.3,15],[24,28.200000000000003,12],[23.2,41.4,12],[20.5,28.9,5],[19.1,35.7,5],[18.5,43.3,5],[20.1,51.5,5],[21.9,58.9,5],[25.3,52.7,5],[25.9,59.7,5],[24.9,66.9,5],[20.1,69.5,5],[14.5,70.7,5]],
[[32.1,28.1,5],[33.1,34.5,5],[34.7,40.7,5],[36.3,46.5,5],[38.3,51.9,5],[30.700000000000003,51.7,5],[31.1,57.5,5],[30.5,62.900000000000006,5],[25.9,69.3,5],[22.5,75.7,5],[22.7,10.7,15],[23.2,27.4,12],[23.2,40.6,12],[20.1,28.9,5],[17.7,33.9,5],[16.5,39.5,5],[14.899999999999999,47.3,5],[13.899999999999999,54.5,5],[27.7,56.5,5],[25.3,50.7,5],[30.9,62.7,5],[31.299999999999997,70.3,5],[29.9,76.1,5]],
[[33.1,29.1,5],[34.7,34.7,5],[36.5,40.9,5],[37.9,45.7,5],[40.1,50.9,5],[30.5,54.7,5],[29.9,60.7,5],[29.1,67.3,5],[23.1,70.3,5],[17.7,73.7,5],[22.1,11.100000000000001,15],[23.2,28.6,12],[23.4,43,12],[18.9,30.9,5],[16.3,36.9,5],[14.5,42.3,5],[12.5,47.9,5],[11.1,53.9,5],[23.7,55.3,5],[25.7,63.900000000000006,5],[29.3,75.1,5],[30.700000000000003,82.5,5],[33.5,90.3,5]],
[[33.7,31.9,5],[34.7,37.9,5],[36.3,43.9,5],[38.3,48.9,5],[41.1,53.5,5],[31.299999999999997,57.5,5],[31.1,64.1,5],[30.299999999999997,71.3,5],[25.1,71.7,5],[19.5,72.7,5],[22.5,15.100000000000001,15],[23,31.4,12],[24,46.6,12],[19.7,32.5,5],[16.7,37.9,5],[14.3,43.1,5],[12.3,49.3,5],[11.7,55.9,5],[23.3,59.1,5],[25.9,64.9,5],[29.3,70.9,5],[28.9,79.1,5],[27.3,87.5,5]],
[[31.700000000000003,30.5,5],[32.3,36.5,5],[34.1,42.9,5],[34.9,48.7,5],[36.1,54.9,5],[31.9,55.3,5],[31.700000000000003,62.900000000000006,5],[31.9,70.9,5],[26.1,70.1,5],[20.3,66.5,5],[22.9,12.5,15],[23.2,29.4,12],[24,44,12],[20.1,30.5,5],[17.7,37.1,5],[16.5,44.7,5],[16.7,51.5,5],[17.5,57.9,5],[24.5,55.7,5],[24.7,63.5,5],[23.3,70.7,5],[22.3,77.9,5],[20.3,84.1,5]],
[[29.5,27.1,5],[30.5,32.3,5],[30.299999999999997,37.9,5],[30.5,44.3,5],[31.1,51.1,5],[23.3,52.3,5],[22.5,59.5,5],[22.5,67.3,5],[19.1,75.5,5],[14.5,82.7,5],[22.9,10.3,15],[22.8,27.200000000000003,12],[23.2,40.8,12],[21.9,28.3,5],[22.1,35.9,5],[21.9,43.3,5],[24.5,51.1,5],[27.5,57.5,5],[31.5,51.3,5],[35.3,59.5,5],[39.1,66.5,5],[35.1,71.9,5],[30.700000000000003,77.1,5]],
[[31.5,27.1,5],[28.5,31.9,5],[27.1,37.3,5],[23.9,42.3,5],[20.1,47.1,5],[33.7,53.5,5],[34.7,60.9,5],[36.9,68.5,5],[39.3,75.7,5],[42.3,84.5,5],[23.1,11.7,15],[24.2,29.4,12],[24.2,42,12],[21.3,30.700000000000003,5],[22.5,36.9,5],[24.9,43.5,5],[28.1,49.9,5],[31.1,55.3,5],[23.9,51.9,5],[22.9,57.5,5],[22.1,63.7,5],[16.7,69.9,5],[10.7,75.5,5]],
[[30.299999999999997,31.700000000000003,5],[28.9,35.3,5],[27.1,38.7,5],[23.1,42.3,5],[19.7,45.7,5],[32.1,53.1,5],[35.3,60.9,5],[38.1,67.7,5],[40.5,76.1,5],[40.3,83.5,5],[22.9,15.5,15],[24.2,32.2,12],[24.8,45,12],[21.9,33.1,5],[23.1,38.9,5],[24.9,46.3,5],[28.1,51.3,5],[31.9,55.7,5],[24.9,54.5,5],[22.7,60.9,5],[21.1,67.9,5],[16.1,71.7,5],[9.9,73.9,5]],
[[27.9,30.1,5],[29.5,35.1,5],[31.1,40.1,5],[31.1,46.1,5],[30.5,52.5,5],[29.1,57.9,5],[29.700000000000003,63.7,5],[29.1,70.1,5],[28.5,75.5,5],[27.5,81.9,5],[20.5,12.7,15],[21.6,31.200000000000003,12],[22.8,46.4,12],[20.9,33.3,5],[18.7,40.9,5],[18.5,49.1,5],[20.1,55.9,5],[21.1,63.099999999999994,5],[26.1,58.7,5],[26.3,65.9,5],[24.9,72.9,5],[23.9,80.9,5],[22.9,88.7,5]],
[[22.1,32.3,5],[20.1,37.9,5],[18.7,44.7,5],[18.7,52.3,5],[19.7,59.1,5],[26.9,57.5,5],[27.7,63.099999999999994,5],[28.7,69.7,5],[26.5,76.1,5],[24.7,82.3,5],[20.7,12.7,15],[20,30.200000000000003,12],[20.6,45,12],[23.7,32.3,5],[24.9,38.7,5],[26.1,45.9,5],[28.3,52.5,5],[32.3,57.9,5],[23.5,58.1,5],[25.7,63.900000000000006,5],[28.9,69.5,5],[22.5,73.5,5],[15.899999999999999,76.7,5]],
[[26.7,28.9,5],[26.3,35.5,5],[26.7,43.3,5],[30.700000000000003,48.7,5],[34.5,53.7,5],[25.7,53.3,5],[23.7,61.7,5],[21.7,68.5,5],[19.9,74.5,5],[17.9,80.9,5],[20.9,10.3,15],[21.8,29.200000000000003,12],[21.8,41.6,12],[21.9,30.700000000000003,5],[20.5,37.1,5],[19.3,45.3,5],[19.1,52.3,5],[19.3,59.3,5],[23.5,53.3,5],[28.5,58.9,5],[31.9,65.5,5],[30.299999999999997,72.3,5],[27.5,77.9,5]],
[[26.3,30.1,5],[26.3,35.1,5],[26.9,39.7,5],[29.700000000000003,45.7,5],[33.7,50.1,5],[27.9,55.7,5],[20.5,64.3,5],[16.9,71.3,5],[11.5,75.1,5],[3.5,78.9,5],[21.5,11.3,15],[21.4,29.200000000000003,12],[20.8,44.4,12],[18.9,30.299999999999997,5],[16.5,35.7,5],[14.3,41.9,5],[12.7,49.1,5],[13.1,55.7,5],[22.3,57.1,5],[29.5,64.3,5],[35.7,72.9,5],[40.3,81.7,5],[45.3,89.1,5]],
[[27.1,32.7,5],[26.9,37.5,5],[27.9,42.5,5],[30.5,48.7,5],[35.5,51.7,5],[28.3,55.5,5],[24.7,63.7,5],[23.3,71.7,5],[16.3,75.9,5],[8.9,77.9,5],[21.1,15.5,15],[21.6,33,12],[21.6,46.2,12],[20.3,34.3,5],[16.3,39.7,5],[14.5,45.5,5],[12.5,52.5,5],[12.5,60.1,5],[23.5,57.9,5],[30.9,64.9,5],[36.5,72.1,5],[36.5,80.7,5],[35.7,88.9,5]],
[[26.9,30.9,5],[27.1,36.7,5],[26.9,43.5,5],[29.5,50.1,5],[33.3,55.9,5],[27.5,57.5,5],[29.700000000000003,63.5,5],[30.9,69.1,5],[22.9,73.5,5],[14.899999999999999,76.3,5],[20.7,12.7,15],[21.6,31.799999999999997,12],[21.8,46,12],[21.9,30.5,5],[18.7,38.1,5],[17.1,45.5,5],[17.1,53.1,5],[19.3,61.3,5],[24.3,58.1,5],[24.5,65.1,5],[24.5,73.3,5],[23.5,80.7,5],[22.7,88.5,5]],
[[22.9,29.5,5],[21.1,35.5,5],[19.3,41.7,5],[19.3,49.1,5],[19.1,55.9,5],[27.5,54.7,5],[33.9,61.5,5],[37.7,67.7,5],[36.7,73.1,5],[33.1,78.3,5],[20.3,10.899999999999999,15],[20.8,29.4,12],[21.4,43.4,12],[25.3,31.299999999999997,5],[25.5,38.5,5],[27.1,45.9,5],[29.1,52.1,5],[32.3,57.3,5],[23.9,56.5,5],[23.1,65.7,5],[21.3,75.7,5],[18.7,82.1,5],[14.5,88.3,5]],
[[20.7,28.5,5],[16.7,33.5,5],[14.7,40.3,5],[15.899999999999999,46.3,5],[15.899999999999999,52.9,5],[29.1,55.3,5],[32.3,61.3,5],[35.5,67.3,5],[39.5,73.7,5],[44.3,80.5,5],[20.9,11.3,15],[21.8,27.799999999999997,12],[21.8,43.2,12],[26.1,32.3,5],[26.9,37.7,5],[28.1,44.1,5],[30.9,50.1,5],[35.3,54.7,5],[23.9,55.7,5],[21.7,65.3,5],[16.3,74.9,5],[9.5,80.5,5],[2.3,85.5,5]],
[[20.5,32.1,5],[17.1,36.3,5],[14.899999999999999,41.7,5],[14.100000000000001,47.9,5],[13.899999999999999,53.7,5],[29.5,57.7,5],[33.1,62.7,5],[37.5,67.7,5],[36.3,74.9,5],[34.1,81.5,5],[20.5,15.5,15],[20.6,33.2,12],[21.8,46.4,12],[26.1,36.1,5],[27.1,41.1,5],[27.7,45.3,5],[29.9,50.5,5],[34.1,54.9,5],[23.1,57.5,5],[22.3,64.7,5],[19.9,71.7,5],[14.899999999999999,76.9,5],[7.5,81.3,5]],
[[14.899999999999999,30.299999999999997,5],[13.899999999999999,37.3,5],[13.3,44.3,5],[14.3,50.3,5],[15.7,56.7,5],[20.7,55.9,5],[20.5,62.7,5],[19.9,69.5,5],[18.5,76.7,5],[17.5,83.1,5],[19.1,13.5,15],[19.6,30.200000000000003,12],[20.6,45.6,12],[31.9,32.3,5],[33.3,38.9,5],[34.1,47.1,5],[34.7,54.1,5],[34.3,62.5,5],[28.3,57.5,5],[28.5,63.900000000000006,5],[28.9,72.3,5],[28.7,80.3,5],[27.1,88.7,5]],
[[15.7,29.5,5],[15.5,35.3,5],[14.899999999999999,41.1,5],[14.899999999999999,47.9,5],[15.100000000000001,54.1,5],[19.7,53.9,5],[18.7,60.3,5],[18.1,67.7,5],[17.3,75.3,5],[16.5,82.7,5],[19.5,11.7,15],[19.6,29.200000000000003,12],[19.4,42.8,12],[30.1,30.5,5],[30.299999999999997,37.5,5],[30.700000000000003,44.5,5],[31.700000000000003,51.7,5],[33.1,59.1,5],[26.5,54.7,5],[28.3,61.1,5],[28.3,67.9,5],[24.5,73.1,5],[20.3,79.3,5]],
[[16.9,27.1,5],[17.5,32.1,5],[21.1,39.9,5],[22.1,44.7,5],[22.9,48.9,5],[25.1,53.5,5],[30.9,59.5,5],[34.7,63.900000000000006,5],[31.9,71.3,5],[29.5,77.5,5],[19.3,10.7,15],[19.8,28.4,12],[19.4,41.4,12],[29.700000000000003,31.5,5],[27.7,38.3,5],[27.1,45.9,5],[27.1,52.7,5],[27.9,59.3,5],[19.7,53.3,5],[19.3,60.9,5],[17.3,67.9,5],[15.7,75.1,5],[13.3,82.1,5]],
[[17.1,28.3,5],[18.5,33.5,5],[20.9,38.5,5],[22.5,43.3,5],[25.1,46.9,5],[18.3,55.3,5],[16.9,63.099999999999994,5],[14.7,71.5,5],[9.5,78.7,5],[4.9,86.5,5],[19.3,11.5,15],[19.2,29,12],[18.6,42.6,12],[28.7,32.7,5],[25.9,39.3,5],[24.5,46.7,5],[23.7,54.3,5],[23.3,61.3,5],[27.9,55.7,5],[32.1,62.099999999999994,5],[36.1,68.3,5],[39.9,73.9,5],[44.3,79.3,5]],
[[17.1,30.700000000000003,5],[18.7,35.1,5],[20.7,38.5,5],[22.7,42.9,5],[26.7,47.3,5],[19.1,57.5,5],[18.5,64.3,5],[16.1,72.3,5],[11.1,77.5,5],[6.699999999999999,82.5,5],[20.1,15.3,15],[19.6,31.6,12],[19.4,45.6,12],[28.3,35.5,5],[25.5,42.3,5],[23.5,48.5,5],[22.1,56.7,5],[22.3,63.5,5],[27.9,58.3,5],[30.9,63.5,5],[35.1,67.7,5],[36.1,75.7,5],[37.9,82.9,5]],
[[15.899999999999999,28.3,5],[14.899999999999999,34.1,5],[15.100000000000001,39.9,5],[15.7,45.7,5],[17.3,52.1,5],[24.1,53.9,5],[26.3,63.3,5],[25.9,71.7,5],[25.1,79.9,5],[24.7,87.7,5],[19.7,12.100000000000001,15],[19.4,29.6,12],[17.8,42.8,12],[28.7,33.5,5],[27.1,40.7,5],[26.5,47.7,5],[25.1,55.1,5],[24.9,62.099999999999994,5],[17.9,53.7,5],[19.3,61.5,5],[21.9,68.9,5],[16.5,72.1,5],[11.7,74.7,5]],
[[17.5,28.5,5],[15.100000000000001,34.3,5],[14.100000000000001,40.3,5],[14.100000000000001,47.1,5],[14.7,53.7,5],[18.9,54.1,5],[22.5,58.9,5],[27.7,62.7,5],[28.3,67.5,5],[29.1,71.9,5],[19.9,10.100000000000001,15],[20.6,28.6,12],[19.2,42.6,12],[30.9,30.299999999999997,5],[31.1,36.7,5],[31.299999999999997,43.3,5],[32.1,50.3,5],[33.5,56.9,5],[25.3,55.3,5],[25.3,65.9,5],[24.7,73.9,5],[22.7,81.7,5],[21.1,88.7,5]],
[[17.5,29.9,5],[14.7,35.9,5],[12.3,41.7,5],[12.1,48.5,5],[12.5,55.1,5],[18.7,52.5,5],[22.9,57.1,5],[26.5,62.5,5],[30.9,67.1,5],[34.7,71.3,5],[19.1,10.899999999999999,15],[19.4,29.200000000000003,12],[19.2,42.8,12],[30.5,31.299999999999997,5],[31.299999999999997,37.1,5],[32.5,42.5,5],[34.3,49.1,5],[35.9,54.7,5],[26.1,54.1,5],[22.9,66.3,5],[21.1,76.3,5],[17.3,82.7,5],[13.7,90.1,5]],
[[17.1,32.5,5],[14.5,37.1,5],[12.9,42.7,5],[11.5,49.1,5],[10.1,55.9,5],[19.1,53.9,5],[21.3,60.3,5],[24.3,67.3,5],[24.1,73.1,5],[24.1,78.9,5],[19.7,15.5,15],[20,32,12],[19.4,45.8,12],[28.9,34.5,5],[30.299999999999997,38.9,5],[32.3,43.3,5],[33.5,48.5,5],[36.1,52.5,5],[25.7,54.3,5],[26.7,61.1,5],[27.7,68.1,5],[23.9,73.5,5],[18.1,79.1,5]],
[[16.3,31.1,5],[15.100000000000001,38.3,5],[13.3,45.5,5],[14.100000000000001,52.3,5],[14.7,59.7,5],[20.1,57.7,5],[20.3,65.3,5],[20.5,73.3,5],[20.9,80.1,5],[21.5,87.5,5],[19.9,13.100000000000001,15],[21.4,29.4,12],[21.4,46.4,12],[33.5,30.700000000000003,5],[35.1,37.9,5],[35.9,45.9,5],[35.7,52.7,5],[35.5,59.1,5],[29.9,57.7,5],[29.9,65.1,5],[29.3,73.3,5],[29.3,80.3,5],[28.9,87.3,5]],
[[16.5,28.7,5],[15.3,35.9,5],[15.3,43.7,5],[15.899999999999999,50.7,5],[15.5,57.5,5],[21.3,55.5,5],[20.3,62.099999999999994,5],[19.7,70.7,5],[21.1,78.9,5],[20.7,86.3,5],[19.9,11.7,15],[21.4,27.200000000000003,12],[21.2,42.6,12],[33.5,29.1,5],[34.3,35.7,5],[34.7,43.7,5],[34.3,57.3,5],[34.3,50.5,5],[28.9,55.5,5],[29.9,62.3,5],[30.299999999999997,69.5,5],[28.3,72.5,5],[26.7,76.1,5]],
[[16.9,27.3,5],[16.3,32.9,5],[17.7,39.3,5],[18.7,45.3,5],[20.3,51.5,5],[28.3,53.7,5],[29.1,57.9,5],[29.700000000000003,62.099999999999994,5],[29.5,65.9,5],[29.1,69.5,5],[20.1,10.3,15],[21.8,27,12],[21.6,41.4,12],[32.3,27.1,5],[33.5,33.7,5],[34.1,41.7,5],[33.9,48.9,5],[33.1,55.9,5],[21.3,53.7,5],[20.1,62.3,5],[19.9,71.1,5],[20.3,79.5,5],[20.5,87.9,5]],
[[18.9,28.3,5],[18.1,34.1,5],[18.9,39.7,5],[20.5,44.5,5],[21.3,49.5,5],[27.9,52.5,5],[28.1,55.5,5],[28.3,58.3,5],[28.7,62.099999999999994,5],[29.1,64.7,5],[20.1,11.5,15],[21.4,27.799999999999997,12],[21,41.8,12],[31.9,28.9,5],[32.9,35.1,5],[32.3,42.1,5],[32.1,48.5,5],[31.5,54.5,5],[19.9,90.3,5],[21.1,52.1,5],[20.5,61.3,5],[20.7,71.5,5],[20.5,80.5,5]],
[[17.3,32.9,5],[17.1,37.9,5],[16.9,42.9,5],[18.3,47.7,5],[19.7,52.5,5],[28.1,55.5,5],[29.5,59.3,5],[29.9,63.5,5],[29.5,67.5,5],[29.700000000000003,70.9,5],[20.3,15.3,15],[22,31.4,12],[21.8,44.4,12],[32.1,32.1,5],[34.1,38.7,5],[33.7,45.9,5],[33.5,52.5,5],[32.7,59.9,5],[21.7,55.3,5],[20.5,61.1,5],[19.3,67.7,5],[21.1,73.5,5],[22.1,79.5,5]],
[[16.7,29.1,5],[15.100000000000001,36.1,5],[14.899999999999999,44.1,5],[15.3,51.7,5],[15.5,57.9,5],[20.7,56.9,5],[20.3,64.3,5],[19.7,71.5,5],[21.5,74.3,5],[22.5,76.3,5],[20.3,11.899999999999999,15],[21.2,28.4,12],[21.4,45,12],[32.9,29.1,5],[33.7,36.1,5],[34.7,43.5,5],[34.5,50.3,5],[34.1,56.9,5],[29.3,56.9,5],[29.700000000000003,63.3,5],[29.9,69.9,5],[28.5,77.9,5],[28.9,86.1,5]],
[[33.3,28.1,5],[33.1,33.5,5],[33.3,38.7,5],[32.3,44.3,5],[30.5,49.5,5],[20.9,52.1,5],[21.1,56.3,5],[20.9,60.7,5],[20.9,65.1,5],[20.9,68.7,5],[19.9,10.3,15],[21.6,27.4,12],[21.8,41,12],[18.1,28.7,5],[16.1,35.3,5],[15.899999999999999,42.9,5],[16.5,49.7,5],[17.3,56.7,5],[28.9,52.5,5],[29.700000000000003,60.7,5],[29.9,69.9,5],[29.700000000000003,79.5,5],[30.1,87.9,5]],
[[31.299999999999997,29.1,5],[31.5,33.7,5],[30.9,38.1,5],[30.299999999999997,41.9,5],[29.5,46.5,5],[22.3,53.9,5],[21.7,56.9,5],[21.5,59.9,5],[20.9,63.099999999999994,5],[20.3,65.7,5],[20.1,11.899999999999999,15],[21.6,42.8,12],[21.2,28.200000000000003,12],[17.9,29.5,5],[17.3,36.1,5],[17.3,42.5,5],[18.1,48.7,5],[18.7,54.5,5],[28.9,54.3,5],[29.3,62.3,5],[29.700000000000003,71.5,5],[30.1,81.1,5],[30.1,90.3,5]],
[[32.5,31.700000000000003,5],[33.1,38.1,5],[33.1,44.5,5],[32.3,49.7,5],[30.5,54.5,5],[21.7,55.7,5],[20.9,59.7,5],[20.3,63.7,5],[20.5,67.5,5],[19.9,71.1,5],[20.1,15.7,15],[21.4,32,12],[22,45.6,12],[18.1,31.9,5],[16.5,38.3,5],[16.3,45.9,5],[16.5,53.1,5],[17.3,59.9,5],[28.9,56.3,5],[30.1,61.5,5],[31.1,67.5,5],[29.700000000000003,73.3,5],[28.5,79.1,5]],
[[32.9,29.3,5],[33.5,36.1,5],[34.9,43.1,5],[34.9,48.9,5],[33.3,55.1,5],[28.1,55.3,5],[28.7,61.7,5],[29.9,68.7,5],[30.9,75.5,5],[31.5,82.3,5],[19.5,11.899999999999999,15],[22.6,30.200000000000003,12],[21,44.6,12],[18.1,31.1,5],[15.899999999999999,38.7,5],[14.5,46.3,5],[14.5,53.5,5],[14.899999999999999,61.3,5],[20.7,57.9,5],[20.3,64.9,5],[20.9,72.5,5],[21.3,79.5,5],[22.1,87.5,5]],
[[33.5,27.9,5],[34.9,33.9,5],[34.3,41.7,5],[33.5,47.1,5],[31.9,52.5,5],[31.700000000000003,55.7,5],[28.9,63.099999999999994,5],[28.1,68.7,5],[32.9,72.5,5],[37.7,75.7,5],[19.5,12.5,15],[24.4,28.4,12],[24.8,43.4,12],[20.3,33.7,5],[21.1,39.3,5],[22.9,47.5,5],[23.1,54.7,5],[23.3,61.3,5],[25.9,55.3,5],[23.9,63.900000000000006,5],[23.3,71.7,5],[24.1,79.7,5],[24.1,87.3,5]],
[[32.5,29.1,5],[34.1,35.3,5],[35.3,42.7,5],[34.9,48.9,5],[34.1,54.7,5],[29.5,54.3,5],[25.7,59.5,5],[23.7,62.3,5],[20.3,65.5,5],[20.3,71.5,5],[19.7,10.7,15],[23.2,28,12],[23.4,41.6,12],[18.1,30.5,5],[17.7,36.5,5],[17.7,42.7,5],[17.1,49.7,5],[15.899999999999999,55.9,5],[23.9,54.1,5],[23.7,62.5,5],[24.5,72.1,5],[26.7,80.3,5],[28.5,88.9,5]],
[[32.5,30.5,5],[34.7,35.9,5],[36.1,42.7,5],[37.1,49.5,5],[35.5,55.7,5],[28.5,53.7,5],[24.9,59.1,5],[21.3,63.900000000000006,5],[17.3,67.9,5],[13.5,71.9,5],[19.5,11.100000000000001,15],[22.8,29.200000000000003,12],[22.6,42.2,12],[18.7,31.1,5],[17.5,36.9,5],[16.9,43.1,5],[15.100000000000001,49.1,5],[12.7,54.9,5],[23.3,53.3,5],[25.1,63.099999999999994,5],[27.1,73.7,5],[31.700000000000003,82.7,5],[34.5,90.3,5]],
[[20.3,34.1,5],[18.9,38.9,5],[17.5,43.1,5],[15.5,47.7,5],[12.5,52.3,5],[29.9,56.1,5],[27.1,60.9,5],[24.7,66.3,5],[24.7,73.1,5],[24.1,79.1,5],[19.7,14.899999999999999,15],[23.2,32.2,12],[22.8,44.6,12],[32.9,32.1,5],[35.5,37.7,5],[36.9,43.1,5],[37.5,49.9,5],[38.5,56.7,5],[23.5,55.3,5],[22.9,61.900000000000006,5],[22.1,68.5,5],[26.9,73.9,5],[31.299999999999997,79.1,5]],
[[33.5,29.3,5],[33.7,34.9,5],[34.7,41.9,5],[34.7,47.5,5],[34.9,53.3,5],[29.1,56.5,5],[29.5,62.3,5],[30.299999999999997,68.3,5],[31.5,75.5,5],[32.3,82.9,5],[19.1,11.899999999999999,15],[23.6,30.200000000000003,12],[23,44,12],[19.1,31.1,5],[18.9,37.1,5],[18.5,43.3,5],[17.5,50.9,5],[16.9,57.7,5],[22.3,56.5,5],[20.5,62.099999999999994,5],[21.1,68.1,5],[25.1,73.9,5],[28.5,79.5,5]],
[[32.9,27.5,5],[32.3,32.7,5],[30.700000000000003,38.3,5],[29.700000000000003,44.1,5],[28.3,47.3,5],[24.1,54.1,5],[18.7,59.3,5],[14.100000000000001,64.3,5],[16.5,70.3,5],[19.9,76.5,5],[19.5,9.899999999999999,15],[23.6,27.799999999999997,12],[23.4,41.6,12],[19.9,31.1,5],[21.3,37.9,5],[21.5,44.9,5],[22.1,51.9,5],[22.1,58.7,5],[30.700000000000003,54.3,5],[30.700000000000003,60.5,5],[30.700000000000003,66.7,5],[33.9,74.1,5],[35.9,82.1,5]],
[[32.5,27.3,5],[32.3,33.1,5],[31.5,39.9,5],[31.1,44.5,5],[30.5,48.7,5],[21.9,54.9,5],[18.7,60.7,5],[14.7,67.3,5],[9.5,73.5,5],[4.9,79.3,5],[19.1,11.3,15],[23,29.200000000000003,12],[23.4,43,12],[19.9,32.5,5],[22.9,38.7,5],[23.9,46.5,5],[25.1,54.1,5],[26.1,61.3,5],[30.700000000000003,54.9,5],[32.1,63.7,5],[34.7,71.9,5],[38.9,79.3,5],[43.9,85.9,5]],
[[31.700000000000003,29.9,5],[32.9,36.3,5],[31.1,44.5,5],[29.3,49.9,5],[30.1,52.7,5],[29.9,58.9,5],[31.9,64.1,5],[33.5,70.7,5],[38.1,76.3,5],[42.3,81.1,5],[19.7,15.5,15],[23.6,33,12],[23.2,48.2,12],[20.7,35.3,5],[23.9,41.5,5],[24.5,47.7,5],[26.1,55.1,5],[26.3,62.7,5],[22.1,58.9,5],[18.3,64.1,5],[14.100000000000001,68.9,5],[12.7,75.7,5],[11.7,82.9,5]],
];

         var drawDescriptorForWarrior = [[0],[0,1],[1],[1,2],[2],[2,3],[3],[3,4],[4],
                                         [5],[5,6],[6],[6,7],[7],[7,8],[8],[8,9],[9],
                                         [10],[11],[11,12],[12],
                                         [13],[13,14],[14],[14,15],[15],[15,16],[16],[16,17],[17],
                                         [18],[18,19],[19],[19,20],[20],[20,21],[21],[21,22],[22]];

         var drawDescriptorForWarriorWithWeapon = [[23],[23,24,0.75,0.25],[23,24],[23,24,0.25,0.75],[24],[23,24,-0.25,1.25],[23,24,-0.5,1.5],[23,24,-0.75,1.75],[23,24,-1,2],
                                                   [0],[0,1],[1],[1,2],[2],[2,3],[3],[3,4],[4],
                                                   [5],[5,6],[6],[6,7],[7],[7,8],[8],[8,9],[9],
                                                   [10],[11],[11,12],[12],
                                                   [13],[13,14],[14],[14,15],[15],[15,16],[16],[16,17],[17],
                                                   [18],[18,19],[19],[19,20],[20],[20,21],[21],[21,22],[22],
                                                   [26],[26,27,0.75,0.25],[26,27],[26,27,0.25,0.75],[27],[26,27,-0.75,1.75],[26,27,-0.5,1.5],[26,27,-0.25,1.25],[26,27,-1,2]];

         var drawDescriptorForWarriorWithShield =
            [[25,25,0.5,0.5,10],
             [0],[0,1],[1],[1,2],[2],[2,3],[3],[3,4],[4],
             [5],[5,6],[6],[6,7],[7],[7,8],[8],[8,9],[9],
             [10],[11],[11,12],[12],
             [13],[13,14],[14],[14,15],[15],[15,16],[16],[16,17],[17],
             [18],[18,19],[19],[19,20],[20],[20,21],[21],[21,22],[22],
             [28,28,0.5,0.5,10]];

         var drawDescriptorForWarriorWithWeaponAndShield =
            [[23],[23,24,0.75,0.25],[23,24],[23,24,0.25,0.75],[24],[23,24,-0.25,1.25],[23,24,-0.5,1.5],[23,24,-0.75,1.75],[23,24,-1,2],[25,25,0.5,0.5,10],
             [0],[0,1],[1],[1,2],[2],[2,3],[3],[3,4],[4],
             [5],[5,6],[6],[6,7],[7],[7,8],[8],[8,9],[9],
             [10],[11],[11,12],[12],
             [13],[13,14],[14],[14,15],[15],[15,16],[16],[16,17],[17],
             [18],[18,19],[19],[19,20],[20],[20,21],[21],[21,22],[22],
             [26],[26,27,0.75,0.25],[26,27],[26,27,0.25,0.75],[27],[26,27,-0.75,1.75],[26,27,-0.5,1.5],[26,27,-0.25,1.25],[26,27,-1,2],[28,28,0.5,0.5,10]];

         var drawDescriptors = [drawDescriptorForWarrior,drawDescriptorForWarriorWithWeapon,drawDescriptorForWarriorWithShield, drawDescriptorForWarriorWithWeaponAndShield];

         var descriptorValueToColor=[2,2,2,2,2,
                                     3,3,3,3,3,
                                     0,1,1,
                                     4,4,4,4,4,
                                     5,5,5,5,5,
                                     6,6,7,6,6,7];

         var weaponData = [
                           [[17.7,52.7,5],[1.7000000000000002,47.7,5],[20,0,5],[30,0,5],[40,0,5],[27.3,62.7,5]],
                           [[1.1,-0.10000000000000009,5],[10.5,-0.10000000000000009,5],[20,0,5],[13.1,55.1,5],[-0.2999999999999998,46.9,5],[29.1,61.900000000000006,5]],
                           [[28.1,55.7,5],[10.3,51.5,5],[20,0,5],[30,0,5],[40,0,5],[14.7,57.3,5]],
                           [[31.9,54.3,5],[15.7,49.9,5],[19.5,-0.10000000000000009,5],[30,0,5],[40,0,5],[12.3,56.1,5]],
                           [[34.1,54.9,5],[18.5,52.3,5],[20,0,5],[30,0,5],[40,0,5],[13.1,54.9,5]],
                           [[28.1,60.3,5],[13.899999999999999,55.3,5],[20,0,5],[29.1,-0.2999999999999998,5],[39.3,-0.10000000000000009,5],[15.7,58.1,5]],
                           [[13.3,55.5,5],[1.1,48.5,5],[20,0,5],[30,0,5],[40,0,5],[27.9,60.7,5]],
                           [[13.7,50.9,5],[1.1,39.9,5],[20,0,5],[30,0,5],[40,0,5],[34.9,56.9,5]],
                           [[12.7,51.7,5],[0.5,39.3,5],[20,0,5],[30,0,5],[40,0,5],[34.9,59.3,5]],
                           [[0,0,5],[10,0,5],[20,0,5],[12.5,57.7,5],[0.10000000000000009,54.9,5],[30.1,63.3,5]],
                           [[0,0,5],[10.1,-0.10000000000000009,5],[20,0,5],[13.5,55.5,5],[4.3,42.3,5],[32.7,57.5,5]],
                           [[18.7,50.3,5],[4.9,46.1,5],[20,0,5],[30,0,5],[40,0,5],[23.5,58.9,5]],
                           [[31.5,47.5,5],[13.899999999999999,49.3,5],[20,0,5],[30,0,5],[40,0,5],[20.3,56.1,5]],
                           [[31.5,46.5,5],[16.1,49.7,5],[20,0,5],[30,0,5],[40,0,5],[18.5,58.5,5]],
                           [[20.5,51.5,5],[5.5,49.5,5],[20,0,5],[30,0,5],[40,0,5],[29.3,59.5,5]],
                           [[3.7,0.2999999999999998,5],[10.9,-0.8999999999999999,5],[20,0,5],[12.1,52.3,5],[0.5,44.5,5],[35.7,52.9,5]],
                           [[1.1,-0.7,5],[8.1,-0.8999999999999999,5],[20,0,5],[10.5,52.1,5],[1.1,39.1,5],[41.1,54.1,5]],
                           [[1.5,-0.10000000000000009,5],[9.7,0.10000000000000009,5],[20,0,5],[9.3,54.1,5],[2.0999999999999996,40.7,5],[39.1,56.7,5]],
                           [[0,0,5],[10,0,5],[20,0,5],[15.100000000000001,59.7,5],[10.9,52.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[19.9,0.2999999999999998,5],[15.5,57.7,5],[15.899999999999999,45.1,5],[35.1,56.3,5]],
                           [[19.1,51.7,5],[11.1,54.9,5],[20,0,5],[30,0,5],[40,0,5],[31.299999999999997,52.9,5]],
                           [[18.5,52.5,5],[10.1,53.5,5],[20,0,5],[30,0,5],[40,0,5],[26.9,57.9,5]],
                           [[0.5,-0.5,5],[10,0,5],[20,0,5],[18.1,54.5,5],[10.7,58.3,5],[30.299999999999997,59.9,5]],
                           [[2.0999999999999996,-0.10000000000000009,5],[10.7,-0.2999999999999998,5],[20,0,5],[16.1,56.9,5],[7.300000000000001,51.9,5],[33.7,57.1,5]],
                           [[0,0,5],[10,0,5],[31.1,51.1,5],[18.1,54.9,5],[19.3,47.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[30.9,50.5,5],[23.7,57.3,5],[26.7,47.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[30.9,54.5,5],[18.9,59.5,5],[22.1,48.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[39.5,56.5,5],[20.1,60.3,5],[37.5,53.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[31.5,50.7,5],[21.5,58.1,5],[36.5,50.3,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[38.5,51.7,5],[13.7,54.1,5],[31.299999999999997,55.3,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[40.7,51.3,5],[11.3,54.3,5],[26.7,55.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[40.5,52.9,5],[11.7,56.1,5],[25.1,55.7,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[36.3,55.1,5],[17.1,57.5,5],[31.1,55.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[30.9,51.1,5],[26.9,57.7,5],[39.7,48.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[19.7,47.1,5],[31.5,55.7,5],[41.9,46.7,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[19.1,46.3,5],[32.3,55.7,5],[43.1,44.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[30.1,53.3,5],[20.7,62.3,5],[37.9,56.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[20.1,58.7,5],[32.7,57.5,5],[42.7,49.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[34.7,52.9,5],[19.3,59.1,5],[37.1,55.7,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[34.1,49.9,5],[12.9,55.7,5],[30.9,56.7,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[35.3,52.3,5],[12.9,60.3,5],[29.3,58.9,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[33.5,55.7,5],[19.7,61.1,5],[35.9,57.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[18.9,55.1,5],[32.1,57.7,5],[45.1,47.9,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[15.3,52.3,5],[35.3,54.7,5],[42.3,43.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[13.899999999999999,53.9,5],[34.5,54.7,5],[43.5,45.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[15.7,56.9,5],[34.7,61.5,5],[45.9,51.7,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[14.100000000000001,53.5,5],[34.1,58.9,5],[39.9,44.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[24.7,45.9,5],[28.1,59.5,5],[39.9,54.3,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[26.1,50.7,5],[23.3,61.7,5],[37.3,56.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[26.5,51.7,5],[22.9,63.7,5],[35.1,60.1,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[16.3,54.1,5],[24.9,61.7,5],[34.9,54.7,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[13.7,53.3,5],[33.3,56.7,5],[40.5,46.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[12.1,54.9,5],[36.3,54.5,5],[43.3,42.5,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[9.5,55.7,5],[36.9,52.5,5],[43.1,39.5,5],[50,0,5]],
                           [[35.3,59.3,5],[35.3,46.7,5],[13.899999999999999,59.1,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[34.7,56.7,5],[34.3,50.7,5],[14.5,57.1,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[33.1,55.5,5],[31.1,43.9,5],[18.7,51.5,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[30.5,54.3,5],[32.5,43.9,5],[22.3,54.1,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[32.7,59.9,5],[34.7,49.5,5],[19.1,54.5,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[34.3,56.3,5],[35.1,46.5,5],[15.3,57.7,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[31.1,48.9,5],[23.5,41.3,5],[16.5,56.5,5],[30,0,5],[40,0,5],[51.3,-0.2999999999999998,5]],
                           [[28.9,49.9,5],[24.7,43.9,5],[17.1,54.5,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[30.1,53.9,5],[26.1,47.7,5],[16.3,60.1,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[33.5,55.1,5],[17.3,45.1,5],[20,0,5],[30,0,5],[40,0,5],[14.3,60.1,5]],
                           [[28.1,55.1,5],[13.7,46.9,5],[20,0,5],[30,0,5],[40,0,5],[22.3,61.5,5]],
                           [[33.9,53.9,5],[19.1,46.9,5],[20,0,5],[30,0,5],[40,0,5],[15.7,55.3,5]],
                           [[35.7,55.3,5],[19.7,49.7,5],[20,0,5],[30,0,5],[40,0,5],[12.5,54.9,5]],
                           [[37.7,56.9,5],[21.9,51.5,5],[20,0,5],[30,0,5],[40,0,5],[11.9,51.9,5]],
                           [[34.9,52.9,5],[18.5,45.5,5],[20,0,5],[30,0,5],[40,0,5],[15.7,57.5,5]],
                           [[26.7,51.1,5],[13.5,41.7,5],[20,0,5],[30,0,5],[40,0,5],[21.7,59.5,5]],
                           [[27.5,51.5,5],[11.9,41.5,5],[19.3,-0.10000000000000009,5],[30,0,5],[40,0,5],[25.7,60.9,5]],
                           [[26.5,52.9,5],[12.7,43.7,5],[20,0,5],[30,0,5],[40,0,5],[25.9,62.099999999999994,5]],
                           [[0,0,5],[10,0,5],[20,0,5],[30,0,5],[40,0,5],[50,0,5]],
                           [[0,0,5],[10,0,5],[20,0,5],[30,0,5],[40,0,5],[50,0,5]],
                         ];

         var heroColoring =['orange','lightgreen','orange','green','orange','green','cyan','black'];
         var opponentColoring =['magenta','lightgreen','magenta','green','magenta','green','cyan','black'];

         function drawBox(boxX,boxY,boxSize,boxColor) {
            context.beginPath();
            context.rect(boxX, boxY, boxSize, boxSize);
            context.fillStyle = boxColor;
            context.fill();
         }

         function drawBoxExtended(ux,uy,rimage,wimage,scale,characterColors,ind1,ind2,w1,w2,rad) {
            var simage = rimage;
            var cind = ind1;
            if ( w1 === undefined ) {
               w1 = 0.5;
            }
            if ( w2 === undefined ) {
               w2 = 0.5;
            }
            if ( ind1 > 22 ) {
               simage = wimage;
               ind1 -= 23;
               if ( ind2 !== undefined ) {
                  ind2 -= 23;
               }
               if ( simage[ind1][1] < 3 ) {
                  return;
               }
            }
            var percentage = tileSize / 50;
            if ( ind2 === undefined ) {
               drawBox(ux+simage[ind1][0]*percentage,
                       uy+simage[ind1][1]*percentage*scale,
                       simage[ind1][2]*percentage,
                       characterColors[descriptorValueToColor[cind]]);
            } else {
               drawBox(ux+(Math.floor(simage[ind1][0]*w1+simage[ind2][0]*w2)-(rad===undefined?0:rad))*percentage,
                       uy+(Math.floor(simage[ind1][1]*w1+simage[ind2][1]*w2)-(rad===undefined?0:rad))*percentage*scale,
                       (rad===undefined?simage[ind1][2]:rad*2)*percentage,
                       characterColors[descriptorValueToColor[cind]]);
            }
         }

         function drawCharacterInternal(x, y, phaseKey, scale, drawDescriptor, characterColors) {
            var cx = (x + y) * Math.sqrt(3) * tileSize + screenWidth / 2;
            var cy = (x - y) * tileSize + screenHeight / 2;
            var [rimage, wimage] = [characterBodyData[phaseKey], weaponData[phaseKey]];
            var ylimitratio = 1.0;
            var percentage = tileSize / 50;
            var ymax = 100 * percentage * scale;
            var xmax = 54  * percentage;
            var ux = Math.floor(cx - xmax/2);
            var uy = Math.floor(cy - ymax + ymax * percentage * 0.1);
            var mx = ux+ux+xmax;
            drawDescriptor.map(box=>drawBoxExtended(ux,uy,rimage,wimage,scale,characterColors,...box));
         }

         //================================== AVATAR ANIMATION ENDS =================================

         var levelMap= [[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,4,0,0,0,0,0,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,4,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0],
                        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,4,0,4,0,0,0,0,1,4,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,1,0,0,0,1,0,1,4,1,0,0,0,0,0,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,1,4,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                        [0,0,1,1,1,1,1,1,4,1,1,4,1,1,1,1,1,1,1,1,4,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0],
                        [0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];

         var figurePosition  = [15.5,15.5];
         var figureFaceDir   = 0; // 0 is south, 1 is east, 2 is north, 3 is west
         var figurePhase     = 0;

         function drawBackground() {
            context.fillStyle = "black";
            context.fillRect(0,0,screenWidth,screenHeight);
         }

         function drawFloor(y,x, color) {
            context.fillStyle = color;
            var px = (x + y) * Math.sqrt(3) * tileSize + screenWidth / 2;
            var py = (x - y) * tileSize + screenHeight / 2;
            context.beginPath();
            context.moveTo( px, py - tileSize );
            context.lineTo( px + Math.sqrt(3) * tileSize, py );
            context.lineTo( px, py + tileSize );
            context.lineTo( px - Math.sqrt(3) * tileSize, py );
            context.closePath();
            context.fill();
         }

         function drawTile(tile,color) {
            if ( tile !== undefined ) {
               context.strokeStyle = color;
               context.beginPath();
               context.moveTo( tile.p1.x, tile.p1.y );
               context.lineTo( tile.p2.x, tile.p2.y );
               context.lineTo( tile.p3.x, tile.p3.y );
               context.lineTo( tile.p4.x, tile.p4.y );
               context.closePath();
               context.stroke();
            }
         }

         function getFloorTile(y,x,obi) {
            var px = (x + y) * Math.sqrt(3) * tileSize + screenWidth / 2;
            var py = (x - y) * tileSize + screenHeight / 2;
            obi.p1 = {x:px,y:py-tileSize};
            obi.p2 = {x:px + Math.sqrt(3) * tileSize,y:py};
            obi.p3 = {x:px,y:py+tileSize};
            obi.p4 = {x:px - Math.sqrt(3) * tileSize,y:py};
            return obi;
         }

         function getKey(diri,phi) {
            return (1+diri*2)*9 + phi;
         }

         function drawCharacter(y,x,character) {
            drawCharacterInternal( x, y, getKey(figureFaceDir,figurePhase), character.scale, drawDescriptors[character.weapon + character.shield*2], character.coloring );
         }

         function drawCursor(x,y) {
            context.fillStyle = "red";
            context.beginPath();
            context.moveTo( x, y );
            context.lineTo( x+15, y+20 );
            context.lineTo( x, y+25 );
            context.closePath();
            context.fill();
         }

         function drawStairs(y,x,color,num) {
            var px = (x + y) * Math.sqrt(3) * tileSize + screenWidth / 2;
            var py = (x - y) * tileSize + screenHeight / 2;

            if ( num == 0 ) {
               context.fillStyle = color;
               context.beginPath();
               context.moveTo( px, py - tileSize - 2* tileSize );
               context.lineTo( px + Math.sqrt(3) * tileSize, py - 2* tileSize );
               context.lineTo( px, py + tileSize );
               context.lineTo( px - Math.sqrt(3) * tileSize, py );
               context.closePath();
               context.fill();
             
               context.fillStyle = "black";
               context.beginPath();
               context.moveTo( px + Math.sqrt(3) * tileSize, py );
               context.lineTo( px + Math.sqrt(3) * tileSize, py - 2* tileSize );
               context.lineTo( px, py + tileSize );
               context.closePath();
               context.fill();
            } 
            
            if ( num == 1 ) {
               context.fillStyle = "black";
               context.beginPath();
               context.moveTo( px, py + tileSize );
               context.lineTo( px - Math.sqrt(3) * tileSize, py );
               context.lineTo( px - Math.sqrt(3) * tileSize, py - 2 * tileSize );
               context.lineTo( px, py - tileSize );
               context.closePath();
               context.fill();

               context.fillStyle = "black";
               context.beginPath();
               context.moveTo( px + Math.sqrt(3) * tileSize, py );
               context.lineTo( px, py + tileSize );
               context.lineTo( px, py - tileSize );

               context.closePath();
               context.fill();
            }
         }

         function drawWall(y,x,num, color) {
            var px = (x + y) * Math.sqrt(3) * tileSize + screenWidth / 2;
            var py = (x - y) * tileSize + screenHeight / 2;

            var bit1 = (num % 2) * 2 - 1;
            var bit2 = (num >= 2) * 2 - 1;

            if ( num < 2 ) {
               context.fillStyle = color;
            } else {
               context.globalAlpha = 0.75;
               context.fillStyle = "#000000";
            }
            context.beginPath();
            context.moveTo( px, py + bit2 * tileSize );
            context.lineTo( px + bit1 * Math.sqrt(3) * tileSize, py );
            context.lineTo( px + bit1 * Math.sqrt(3) * tileSize, py - 2 * tileSize );
            context.lineTo( px, py + (bit2-2) * tileSize );
            context.closePath();
            context.fill();
            context.globalAlpha = 1.0;
         }

         function getMapCell(y,x) {
            return ( y < levelMap.length && y >= 0 && x < levelMap[y].length && x >= 0 ? levelMap[y][x] : 0 );
         }

         function isMapCellVisible(y,x,cy,cx,oy,ox,sx=0.5+ox,sy=0.5+oy,debug=0) {
            var dirY  = y - oy;
            var dirX  = x - ox;
            var dirL  = Math.hypot(dirX,dirY);
            dirY /= dirL;
            dirX /= dirL;

            var celly   = cy;
            var cellx   = cx;

            var dist    = 0;
            var arrived = 0;
            var limit   = 50;
            var err     = 1e-6;

            while ( limit && getMapCell( celly, cellx ) != 0 && !( celly == cy + y && cellx == cx + x ) ) {
               --limit;
               var jump  = Math.min( Math.max( ( 1 - sx ) / dirX, -sx / dirX ),
                                     Math.max( ( 1 - sy ) / dirY, -sy / dirY ) );
               dist += jump;
               sx = sx + dirX * jump;
               sy = sy + dirY * jump;
               if ( Math.abs(sx) < err && dirX < 0) {
                  sx = 1;
                  cellx -= 1;
                  arrived = 1;
               } else if ( Math.abs(1-sx) < err && dirX > 0 ) {
                  sx = 0;
                  cellx += 1;
                  arrived = 2;
               }
               if ( Math.abs(sy) < err && dirY < 0 ) {
                  sy = 1;
                  celly -= 1;
                  arrived = 3;
               } else if ( Math.abs(1-sy) < err && dirY > 0 ) {
                  sy = 0;
                  celly += 1;
                  arrived = 4;
               }
            }

            return ( celly == cy + y && cellx == cx + x );
         }

         function drawCellFloor(y,x,cy,cx,oy,ox,tiles) {
            if ( getMapCell(cy+y,cx+x) != 5 ) {
               drawFloor(-y+oy,x-ox, "#AAAAAA");
               var obi = {x:x+cx,y:y+cy};
               tiles.push(getFloorTile(-y+oy,x-ox,obi));
            }
         }

         function drawCell(figurePos,y,x,cy,cx,oy,ox) {
            if ( !getMapCell(cy+y,cx+x-1) ) {
               drawWall(-y+oy,x-ox,0, "gray");
            }
            if ( !getMapCell(cy+y-1,cx+x) ) {
               drawWall(-y+oy,x-ox,1, "gray");
            }

            if ( Math.floor(figurePos[0]+y-cy) == 0 && Math.floor(figurePos[1]+x-cx) == 0 ) {
               drawCharacter(-y,x,{scale:1,coloring:heroColoring,weapon:1,shield:1});
            }

            if ( !getMapCell(cy+y+1,cx+x) ) {
               drawWall(-y+oy,x-ox,2, "blue");
            }
            if ( !getMapCell(cy+y,cx+x+1) ) {
               drawWall(-y+oy,x-ox,3, "blue");
            }
         }


         function drawForeground( camCenter, figurePos, tiles=[] ) {
            var cy = Math.floor(camCenter[0]);
            var cx = Math.floor(camCenter[1]);
            var oy = camCenter[0] - cy - 0.5;
            var ox = camCenter[1] - cx - 0.5;

            var cellsy = [];
            var cellsx = [];

            for ( var y = -mapRadius; y < mapRadius; ++y ) {
               for ( var x = -mapRadius; x < mapRadius; ++x ) {
                  if ( isMapCellVisible(y,x,cy,cx,oy,ox) 
                       || isMapCellVisible(y,x,cy,cx,oy,ox,0,0) 
                       || isMapCellVisible(y,x,cy,cx,oy,ox,0,1) 
                       || isMapCellVisible(y,x,cy,cx,oy,ox,1,0) 
                       || isMapCellVisible(y,x,cy,cx,oy,ox,1,1) )
                  {
                     if ( getMapCell(cy+y,cx+x) ) {
                        cellsy.push(y);
                        cellsx.push(x);
                     }
                  }
               }
            }

            for ( var i = 0; i < cellsx.length; ++i ) {
               drawCellFloor(cellsy[i],cellsx[i],cy,cx,oy,ox,tiles);
            }

            for ( var i = 0; i < cellsx.length; ++i ) {
               drawCell(figurePos,cellsy[i],cellsx[i],cy,cx,oy,ox);
            }
         }

         function getPointSide(p1,p2,p3) {
            var sx = p1.y - p2.y;
            var sy = p2.x - p1.x;
            return Math.sign(sx * (p3.x-p1.x) + sy * (p3.y-p1.y));
         }

         function isPointInTriangle(p1,p2,p3,pt) {
            var retval = ( getPointSide(p1,p2,p3) * getPointSide(p1,p2,pt) >= 0 )
                      && ( getPointSide(p2,p3,p1) * getPointSide(p2,p3,pt) >= 0 )
                      && ( getPointSide(p3,p1,p2) * getPointSide(p3,p1,pt) >= 0 );
            return retval;
         }

         function bfs(source,target) {
            if ( !getMapCell(source.y,source.x) ) {
               return [];
            }
            var hops = {};
            var findings = [[source.y,source.x]];
            hops[findings[0]]=false;
            var level = 0;
            var dirs = [[0,1],[-1,0],[0,-1],[1,0]];
            while ( level < 10 && findings.length > 0 ) {
               ++level;
               var nfindings = [];
               for ( var i = 0; i < findings.length; ++i ) {
                  for ( var mag = 0; mag <= 1*(getMapCell(findings[i][0],findings[i][1]) == 6); ++mag ) {
                     for ( var j = 0; j < dirs.length; ++j ) {
                        var nextp = [(findings[i][0]+dirs[j][1]),(findings[i][1]+dirs[j][0])];
                        if ( getMapCell(nextp[0],nextp[1]) && hops[nextp] === undefined ) {
                           nfindings.push(nextp);
                           hops[nextp] = findings[i];
                        }
                     }
                  }
               }
               findings = nfindings;
            }
            var tara = [target.y,target.x];
            var way = [];
            if ( hops[tara] !== undefined ) {
               way.push(tara);
               var maxi = 100;
               while(hops[tara] && maxi-- ) {
                  way.push(hops[tara]);
                  tara = hops[tara];
               }
            }
            way.reverse();
            return way;
         }

         function getCursorsTile(tiles, cx, cy) {
            for ( var i = 0; i < tiles.length; ++i ) {
               if ( isPointInTriangle( tiles[i].p1, tiles[i].p2, tiles[i].p4, {x:cx,y:cy} )
                 || isPointInTriangle( tiles[i].p2, tiles[i].p3, tiles[i].p4, {x:cx,y:cy} ) ) {
                  return tiles[i];
               }
            }
         }

         function moveFigure() {
            if ( figureWay.length == 0 ) {
               figurePhase = 0;
               return; 
            }

            figurePhase = ( (figurePhase) % 8 + 1 );

            var ctar = figureWay[0];
           
            for ( var i = 0; i < 2; ++i ) {
               if ( Math.abs(ctar[i] + 0.5 - figurePosition[i]) > 0.1 ) {
                  var sgn = Math.sign( ctar[i] + 0.5 - figurePosition[i] );
                  figurePosition[i] += 0.1 * sgn;
                  figureFaceDir = 2 * ( sgn < 0 ) + i;
                  return;
               } else {
                  figurePosition[i] = ctar[i] + 0.5;
               }
            }

            figureWay.reverse();
            figureWay.pop();
            figureWay.reverse();
         }

         // common functions 
         function drawScene() {
            setTimeout( function() {
               drawBackground();
               var tiles = [];
               drawForeground(figurePosition, figurePosition, tiles);
               drawCursor(curX,curY);
               curTarg = getCursorsTile(tiles,curX,curY);
               drawTile(curTarg, "yellow");
               ANIMATION = requestAnimationFrame(drawScene);
               moveFigure();
            }, 1000 / fps );
         }

         function initCanvas() {
            screenWidth  = mainItem.width  = window.innerWidth  - 20;
            screenHeight = mainItem.height = window.innerHeight - 20;
            screenScale  = Math.min( screenWidth, screenHeight ) / 2;
            mapRadiusX = screenWidth/4/tileSize/Math.sqrt(3);
            mapRadiusY = screenHeight/4/tileSize;
            mapRadius = Math.ceil(2 * Math.max(mapRadiusX,mapRadiusY));

            // starting the engine only if it is not running
            if ( !ANIMATION ) {
               drawScene();
            }
         }

         mainItem.onmousedown = function(event) {
            if ( curTarg === undefined ) {
               return;
            }
            var way = bfs({x:Math.floor(figurePosition[1]),y:Math.floor(figurePosition[0])},curTarg);
            figureWay = way;
         };

         mainItem.onmouseup = function(event) {};

         mainItem.onmousemove = function(event) { [curX,curY] = [event.clientX,event.clientY]; };

         //init
         (function() {
            initCanvas();
            addEventListener('resize', initCanvas, false);
         })();
      </script>
   </body>
</html>
